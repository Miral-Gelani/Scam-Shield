<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scam Shield | Cyber Security System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- GOOGLE FONT - CHANGED TO ORBITRON -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* FULL CSS RESET TO PREVENT OVERLAPS */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Times New Roman', serif; /* Changed to Times for readable body text */
}

/* Keep headings in Orbitron for the cyber theme */
h1, h2, h3, button, .nav button {
  font-family: 'Orbitron', sans-serif; /* Headings and buttons stay futuristic */
}

body {
  background: radial-gradient(circle at top, #0f2027, #000);
  color: #00ffcc;
  height: 100vh;
  overflow: hidden;
  line-height: 1.5;
}

.view {
  display: none;
  height: 100vh;
  width: 100vw;
  padding: 100px 40px 40px 40px; /* Adjusted for top nav bar */
  animation: fade 0.6s;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  position: relative;
}

.active {
  display: flex;
  z-index: 1;
}

@keyframes fade {
  from { opacity: 0; }
  to { opacity: 1; }
}

button {
  background: #00ffcc;
  color: #000;
  padding: 15px 35px;
  border: none;
  border-radius: 40px;
  font-size: 1.1rem;
  cursor: pointer;
  box-shadow: 0 0 25px #00ffcc;
  transition: all 0.3s ease;
  margin: 10px 0;
  text-transform: uppercase;
}

button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 40px #00ffcc;
}

.center {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  text-align: center;
  width: 100%;
}

/* ENHANCED 3D CYBER BACKGROUND (NO IMAGE, PURE CSS) */
.cyber-bg {
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(0,255,204,0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(0,255,204,0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(0,255,204,0.08) 0%, transparent 50%),
    linear-gradient(135deg, #0f2027 0%, #000 100%);
  z-index: -1;
  animation: cyberPulse 10s infinite linear;
}

@keyframes cyberPulse {
  0% { opacity: 0.8; }
  50% { opacity: 1; }
  100% { opacity: 0.8; }
}

/* FLOATING CYBER ELEMENTS */
.cyber-elements {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
}

.cyber-elements::before,
.cyber-elements::after {
  content: '';
  position: absolute;
  width: 200px;
  height: 200px;
  background: radial-gradient(circle, rgba(0,255,204,0.1), transparent);
  border-radius: 50%;
  animation: float 8s infinite ease-in-out;
}

.cyber-elements::before {
  top: 10%;
  left: 10%;
  animation-delay: 0s;
}

.cyber-elements::after {
  bottom: 10%;
  right: 10%;
  animation-delay: 4s;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

/* GLOWING GRID LINES */
.grid-overlay {
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(0,255,204,0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,204,0.1) 1px, transparent 1px);
  background-size: 50px 50px;
  z-index: -1;
  animation: gridShift 20s infinite linear;
}

@keyframes gridShift {
  0% { background-position: 0 0; }
  100% { background-position: 50px 50px; }
}

/* CARDS WITH ENHANCED EFFECTS */
.card {
  background: rgba(0,0,0,.85);
  border: 2px solid #00ffcc;
  border-radius: 16px;
  padding: 25px;
  margin: 30px 0;
  box-shadow: 0 0 30px rgba(0,255,204,.4), inset 0 0 20px rgba(0,255,204,.1);
  transition: all 0.3s ease;
  line-height: 1.8;
  width: 100%;
  max-width: 800px;
}

.card:hover {
  box-shadow: 0 0 50px rgba(0,255,204,.6), inset 0 0 30px rgba(0,255,204,.2);
  transform: translateY(-5px);
}

/* PROGRESS BAR WITH GLOW */
.bar {
  height: 20px;
  background: #111;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: inset 0 0 10px rgba(0,255,204,0.5);
  margin: 20px 0;
  width: 100%;
}

.fill {
  height: 100%;
  width: 0;
  background: linear-gradient(90deg, #00ffcc, #00cccc);
  transition: 1s;
  box-shadow: 0 0 20px #00ffcc;
}

/* TEXTAREA WITH GLOW */
textarea {
  width: 100%;
  height: 160px;
  background: #000;
  color: #00ffcc;
  border: 2px solid #00ffcc;
  border-radius: 12px;
  padding: 15px;
  font-size: 1rem;
  box-shadow: inset 0 0 10px rgba(0,255,204,0.3);
  transition: all 0.3s ease;
  resize: vertical;
  margin: 20px 0;
  font-family: 'Orbitron', sans-serif; /* Match new font */
}

textarea:focus {
  box-shadow: inset 0 0 20px rgba(0,255,204,0.5), 0 0 20px rgba(0,255,204,0.5);
  outline: none;
}

/* HORIZONTAL NAV BAR AT TOP */
.nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: rgba(0,0,0,0.9);
  border-bottom: 2px solid #00ffcc;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  z-index: 10;
  box-shadow: 0 0 20px rgba(0,255,204,0.5);
}

.nav button {
  padding: 8px 15px;
  font-size: 0.9rem;
  background: rgba(0,255,204,0.2);
  color: #00ffcc;
  border: 1px solid #00ffcc;
  transition: all 0.3s ease;
  text-transform: uppercase;
}

.nav button:hover {
  background: #00ffcc;
  color: #000;
  box-shadow: 0 0 20px #00ffcc;
}

/* TYPING ANIMATION FOR HEADERS WITH BLINKING CURSOR */
h1, h2, h3 {
  animation: type 2s steps(40, end), blink 1s infinite step-end 2s;
  overflow: hidden;
  white-space: nowrap;
  border-right: 2px solid #00ffcc;
  margin-bottom: 30px;
  text-align: center;
  text-transform: uppercase;
  font-weight: bold;
}

@keyframes type {
  from { width: 0; }
  to { width: 100%; }
}

@keyframes blink {
  from, to { border-color: transparent; }
  50% { border-color: #00ffcc; }
}
/* SCAN LOG WITH FADE-IN */
#log {
  animation: fadeInUp 1s ease-out;
  white-space: pre-line;
  margin-bottom: 20px;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* LIST STYLING */
ul {
  list-style-type: disc;
  padding-left: 20px;
}

li {
  margin-bottom: 15px;
}

/* MODALS FOR SIGN UP AND LOG IN */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: rgba(0,0,0,0.95);
  border: 2px solid #00ffcc;
  border-radius: 20px;
  padding: 30px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 0 50px rgba(0,255,204,0.5);
  animation: modalFade 0.3s ease;
}

@keyframes modalFade {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

.close {
  color: #00ffcc;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close:hover {
  color: #ff00cc;
}

input {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border: 2px solid #00ffcc;
  border-radius: 10px;
  background: rgba(0,0,0,0.8);
  color: #00ffcc;
  font-size: 1rem;
}

input:focus {
  outline: none;
  box-shadow: 0 0 15px rgba(0,255,204,0.5);
}

/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  .view { padding: 80px 20px 20px 20px; }
  h1 { font-size: 3rem; }
  .nav { height: 50px; gap: 10px; }
  .nav button { padding: 6px 10px; font-size: 0.8rem; }
  .card { padding: 15px; margin: 20px 0; }
}
</style>
</head>
<body>
<div class="cyber-bg"></div>
<div class="cyber-elements"></div>
<div class="grid-overlay"></div>

<!-- HORIZONTAL NAV BAR -->
<div class="nav" id="navBar" style="display: none;">
<button onclick="show('input')">INPUT</button>
<button onclick="show('scan')">SCAN</button>
<button onclick="show('analysis')">ANALYSIS</button>
<button onclick="show('report')">REPORT</button>
<button onclick="show('history')">HISTORY</button>
<button onclick="logout()">LOG OUT</button>
<button onclick="show('profile')">PROFILE</button>
</div>

<!-- MODALS -->
<div id="signupModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('signup')">&times;</span>
    <h2>SIGN UP</h2>
    <input type="text" id="signupUsername" placeholder="Username">
    <input type="email" id="signupEmail" placeholder="Email">
    <input type="password" id="signupPassword" placeholder="Password">
    <button onclick="signup()">SIGN UP</button>
  </div>
</div>

<div id="loginModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('login')">&times;</span>
    <h2>LOG IN</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">LOG IN</button>
  </div>
</div>

<!-- EDIT PROFILE MODAL -->
<div id="editProfileModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('editProfile')">&times;</span>
    <h2>EDIT PROFILE</h2>
    <input type="text" id="editUsername" placeholder="Username">
    <input type="email" id="editEmail" placeholder="Email">
    <input type="password" id="editPassword" placeholder="New Password (leave blank to keep current)">
    <button onclick="saveProfile()">SAVE CHANGES</button>
  </div>
</div>

<!-- WELCOME -->
<div id="welcome" class="view active">
<div class="center">
<h1 style="font-size:4.5rem;text-shadow:0 0 40px #00ffcc">SCAM SHIELD</h1>
<p style="max-width:700px;margin:25px;font-size:1.2rem">
DIVE INTO THE DIGITAL FORTRESS! OUR ADVANCED AI-POWERED CYBER FORENSIC ENGINE SCANS FOR HIDDEN THREATS,
UNMASKS PHISHING SCHEMES, AND SHIELDS YOU FROM FINANCIAL SCAMS AND SOCIAL-ENGINEERING TRAPS.
STAY ONE STEP AHEAD IN THE CYBER MATRIX.
</p>
<button onclick="openModal('signup')">SIGN UP</button>
<button onclick="openModal('login')">LOG IN</button>
</div>
</div>

<!-- INPUT -->
<div id="input" class="view">
<h2>INPUT SUSPICIOUS DATA STREAM</h2>
<textarea id="msg" placeholder="FEED THE SUSPICIOUS DATA INTO THE NEURAL NETWORK..."></textarea>
<br><br>
<button onclick="startScan()">INITIATE CYBER SCAN</button>
</div>

<!-- SCAN -->
<div id="scan" class="view">
<h2>NEURAL NETWORK SCANNING...</h2>
<div class="card" id="log"></div>
<div class="bar"><div class="fill" id="scanBar"></div></div>
</div>

<!-- ANALYSIS -->
<div id="analysis" class="view">
<h2>AI THREAT ANALYSIS CORE</h2>
<div class="card" id="analysisBox"></div>
</div>

<!-- REPORT -->
<div id="report" class="view">
<h2>DIGITAL FORENSIC VERDICT</h2>

<div class="card">
<h3>THREAT MATRIX BREAKDOWN</h3>
<p id="dangerText"></p>
</div>

<div class="card">
<h3>DEFENSE PROTOCOLS</h3>
<ul id="advice"></ul>
</div>

<button onclick="downloadPDF()">EXPORT CYBER REPORT</button>
</div>

<!-- HISTORY -->
<div id="history" class="view">
<h2>SCAN ARCHIVE LOG</h2>
<div id="historyList"></div>
</div>

<!-- PROFILE -->
<div id="profile" class="view">
<h2>USER PROFILE MATRIX</h2>
<div class="card">
<h3>PROFILE DETAILS</h3>
<p id="profileInfo"></p>
<button onclick="editProfile()">EDIT PROFILE</button>
</div>
</div>

<script>
let resultData = {};
let isLoggedIn = false;

function show(id) {
  if (!isLoggedIn && id !== 'welcome') {
    alert('Please log in first!');
    show('welcome');
    return;
  }
  document.querySelectorAll('.view').forEach(v => {
    v.classList.remove('active');
    v.style.display = 'none';
  });
  const target = document.getElementById(id);
  target.classList.add('active');
  target.style.display = 'flex';
  if (id === 'profile') showProfile();
}

window.onload = function() {
  show('welcome');
  checkLoginStatus();
};

function checkLoginStatus() {
  const user = localStorage.getItem('user');
  if (user) {
    isLoggedIn = true;
    document.getElementById('navBar').style.display = 'flex';
  }
}

function openModal(type) {
  document.getElementById(type + 'Modal').style.display = 'flex';
}

function closeModal(type) {
  document.getElementById(type + 'Modal').style.display = 'none';
}

async function signup() {
  const username = document.getElementById('signupUsername').value;
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;

  if (!username || !email || !password) {
    alert('Please fill in all fields.');
    return;
  }

  // Simple email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    alert(' Please enter a valid email address.');
    return;
  }

  // Simulate signup (in real app, send to server)
  const user = { username, email, password };
  localStorage.setItem('user', JSON.stringify(user));
  isLoggedIn = true;
  document.getElementById('navBar').style.display = 'flex';
  closeModal('signup');
  show('input');
  alert('Signup successful! Welcome to Scam Shield.');
}

async function login() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  if (!email || !password) {
    alert('Please fill in all fields.');
    return;
  }

  // Simple email validation for login
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    alert(' Please enter a valid email address.');
    return;
  }

  // Simulate login (in real app, verify with server)
  const storedUser = JSON.parse(localStorage.getItem('user'));
  if (storedUser && storedUser.email === email && storedUser.password === password) {
    isLoggedIn = true;
    document.getElementById('navBar').style.display = 'flex';
    closeModal('login');
    show('input');
    alert('Login successful! Welcome back.');
  } else {
    alert(' Invalid email or password.');
  }
}
function logout() {
  localStorage.removeItem('user');
  isLoggedIn = false;
  document.getElementById('navBar').style.display = 'none';
  show('welcome');
  alert('Logged out successfully.');
}

async function startScan() {
  const msg = document.getElementById('msg').value.trim();
  if (!msg) { alert("ENTER MESSAGE"); return; }
  show('scan');
  const steps = [
    "BOOTING AI CORE...",
    "DECRYPTING DATA PATTERNS...",
    "SCANNING FOR CYBER ANOMALIES...",
    "ASSESSING THREAT VECTORS...",
    "COMPILING FORENSIC OUTPUT..."
  ];
  let log = document.getElementById('log');
  let bar = document.getElementById('scanBar');
  log.innerHTML = "";
  for (let i = 0; i < steps.length; i++) {
    log.innerHTML += `<span style="color:#00ffcc;">${steps[i]}</span><br>`;
    bar.style.width = ((i + 1) / steps.length * 100) + "%";
    await new Promise(r => setTimeout(r, 900));
  }

  // Enhanced dynamic scan result based on keywords
  const lowerMsg = msg.toLowerCase();
  let category = 'Safe Message';
  let status = 'LOW RISK';
  let score = 10;
  let explanation = 'No threats detected. Message appears safe.';
  let advice = ['Continue with caution.'];
  let urgency = 'Low - No Urgency';
  let financialRisk = 'Low - No Financial Threat';
  let socialEngineering = 'Low - No Manipulation Detected';
  let psychologicalTechniques = 'None';
  let redFlags = [];
  let potentialImpact = 'Minimal - No significant risk.';
  let legalReference = 'N/A';

  if (lowerMsg.includes('urgent') || lowerMsg.includes('immediate')) {
    category = 'Phishing Scam';
    status = 'HIGH RISK';
    score = 85;
    explanation = 'This message creates fear by claiming unauthorized transactions and forces the user to act immediately. Such urgency prevents logical thinking and may lead to financial loss or identity theft.';
    advice = ['Do NOT share OTP or PIN.', 'Do NOT click unknown links.', 'Block the sender.', 'Report to cybercrime.gov.in.', 'Inform bank immediately.'];
    urgency = 'High - Immediate Action Required';
    financialRisk = 'High - Potential Loss of Funds';
    socialEngineering = 'High - Manipulates Trust';
    psychologicalTechniques = 'Fear, Urgency';
    redFlags = ['OTP request', 'Payment demand', 'Suspicious link'];
    potentialImpact = 'Financial Loss, Identity Theft Risk, Account Takeover Possibility';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  } else if (lowerMsg.includes('bank') || lowerMsg.includes('account') || lowerMsg.includes('otp')) {
    category = 'Financial Fraud';
    status = 'HIGH RISK';
    score = 90;
    explanation = 'Detected financial keywords indicating potential account compromise or fraud. Scammers impersonate banks to steal credentials.';
    advice = ['Do NOT share banking details.', 'Contact your bank directly.', 'Enable two-factor authentication.', 'Report to cybercrime.gov.in.'];
    urgency = 'Medium - Verify Soon';
    financialRisk = 'High - Potential Loss of Funds';
    socialEngineering = 'High - Exploits Trust in Institutions';
    psychologicalTechniques = 'Authority Impersonation, Fear';
    redFlags = ['OTP request', 'Fake authority claim', 'Payment demand'];
    potentialImpact = 'Financial Loss, Data Theft, Legal Consequences';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  } else if (lowerMsg.includes('prize') || lowerMsg.includes('win') || lowerMsg.includes('lottery')) {
    category = 'Lottery Scam';
    status = 'MEDIUM RISK';
    score = 70;
    explanation = 'Detected prize-related keywords often used in lottery scams to lure victims with false promises of wealth.';
    advice = ['Never pay to claim prizes.', 'Legitimate lotteries do not require upfront fees.', 'Report suspicious emails.', 'Block the sender.'];
    urgency = 'Low - No Rush';
    financialRisk = 'High - Potential Loss';
    socialEngineering = 'High - Exploits Greed';
    psychologicalTechniques = 'Reward Temptation, Greed';
    redFlags = ['Payment demand', 'Fake prize claim'];
    potentialImpact = 'Financial Loss, Identity Theft';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  } else if (lowerMsg.includes('invest') || lowerMsg.includes('crypto') || lowerMsg.includes('stock')) {
    category = 'Investment Scam';
    status = 'MEDIUM RISK';
    score = 65;
    explanation = 'Detected investment keywords indicating potential Ponzi or fake investment schemes promising high returns.';
    advice = ['Research investments independently.', 'Avoid high-return promises.', 'Consult a financial advisor.', 'Report to cybercrime.gov.in.'];
    urgency = 'Medium - Evaluate Carefully';
    financialRisk = 'High - Potential Loss';
    socialEngineering = 'Medium - Exploits Hope for Gains';
    psychologicalTechniques = 'Reward Temptation, Hope';
    redFlags = ['High return promises', 'Urgent investment call'];
    potentialImpact = 'Financial Loss, Legal Consequences';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  } else if (lowerMsg.includes('click') || lowerMsg.includes('link') || lowerMsg.includes('verify')) {
    category = 'Phishing Scam';
    status = 'HIGH RISK';
    score = 80;
    explanation = 'Detected phishing keywords urging clicks or verification, common in malware distribution and data theft.';
    advice = ['Do NOT click unknown links.', 'Hover over links to check URLs.', 'Use antivirus software.', 'Report to cybercrime.gov.in.'];
    urgency = 'High - Immediate Action Required';
    financialRisk = 'Medium - Potential Malware';
    socialEngineering = 'High - Builds False Urgency';
    psychologicalTechniques = 'Urgency, Authority Impersonation';
    redFlags = ['Suspicious link', 'Verification demand'];
    potentialImpact = 'Data Theft, Malware Infection, Account Takeover';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  } else if (lowerMsg.includes('job') || lowerMsg.includes('employment')) {
    category = 'Job Scam';
    status = 'MEDIUM RISK';
    score = 60;
    explanation = 'Detected job-related keywords often used in scams promising employment for fees or personal data.';
    advice = ['Never pay for job opportunities.', 'Verify employers independently.', 'Report to cybercrime.gov.in.'];
    urgency = 'Low - No Rush';
    financialRisk = 'Medium - Potential Loss';
    socialEngineering = 'Medium - Exploits Job Seekers';
    psychologicalTechniques = 'Reward Temptation, Hope';
    redFlags = ['Fee for job', 'Personal data request'];
    potentialImpact = 'Financial Loss, Identity Theft';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  } else if (lowerMsg.includes('identity') || lowerMsg.includes('theft')) {
    category = 'Identity Theft';
    status = 'HIGH RISK';
    score = 95;
    explanation = 'Detected keywords related to identity theft, where scammers steal personal information for fraudulent activities.';
    advice = ['Do NOT share personal details.', 'Monitor accounts regularly.', 'Report to cybercrime.gov.in.'];
    urgency = 'High - Immediate Action Required';
    financialRisk = 'High - Potential Loss of Funds';
    socialEngineering = 'High - Exploits Trust';
    psychologicalTechniques = 'Fear, Authority Impersonation';
    redFlags = ['Personal data request', 'Threat of theft'];
    potentialImpact = 'Identity Theft, Financial Loss, Legal Consequences';
    legalReference = 'IT Act 2000 ‚Äì Section 66D (Cyber Fraud)';
  }

  resultData = {
    reportId: 'SCAM-' + Math.random().toString(36).substr(2, 8).toUpperCase(),
    scanDateTime: new Date().toLocaleString(),
    inputType: 'SMS / Email / WhatsApp / Website / Call Script', // Simulated
    source: 'N/A', // Simulated
    userLocation: 'N/A', // Simulated
    category,
    targetVictim: category === 'Safe Message' ? 'N/A' : 'General Public',
    status,
    score,
    urgencyDetected: urgency.includes('High') ? 'Yes' : 'No',
    financialThreat: financialRisk.includes('High') ? 'Yes' : 'No',
    psychologicalTechniques,
    redFlags,
    explanation,
    potentialImpact,
    advice,
    legalReference
  };

  showAnalysis();
}

function showAnalysis() {
  show('analysis');
  document.getElementById('analysisBox').innerHTML = `
  <h3>1Ô∏è‚É£ BASIC CASE INFORMATION</h3>
  <b>Report ID:</b> ${resultData.reportId}<br>
  <b>Scan Date & Time:</b> ${resultData.scanDateTime}<br>
  <b>Input Type:</b> ${resultData.inputType}<br>
  <b>Source:</b> ${resultData.source}<br>
  <b>User Location:</b> ${resultData.userLocation}<br>
  <br>
  <h3>2Ô∏è‚É£ SCAM CLASSIFICATION</h3>
  <b>Scam Type:</b> ${resultData.category}<br>
  <b>Target Victim:</b> ${resultData.targetVictim}<br>
  <br>
  <h3>3Ô∏è‚É£ THREAT SEVERITY ASSESSMENT</h3>
  <b>Risk Level:</b> ${resultData.status === 'HIGH RISK' ? 'üî¥ High' : resultData.status === 'MEDIUM RISK' ? 'üü† Medium' : 'üü¢ Low'}<br>
  <b>Risk Score:</b> ${resultData.score}%<br>
  <b>Urgency Detected:</b> ${resultData.urgencyDetected}<br>
  <b>Financial Threat Present:</b> ${resultData.financialThreat}<br>
  <br>
  <h3>4Ô∏è‚É£ SCAM PATTERN ANALYSIS</h3>
  <b>Psychological Techniques Used:</b> ${resultData.psychologicalTechniques}<br>
  <b>Red Flags Detected:</b> ${resultData.redFlags.join(', ')}<br>
  <br>
  <h3>5Ô∏è‚É£ WHY THIS SCAM IS DANGEROUS</h3>
  ${resultData.explanation}<br>
  <br>
  <h3>6Ô∏è‚É£ POTENTIAL IMPACT ANALYSIS</h3>
  ${resultData.potentialImpact}<br>
  <br>
  <h3>7Ô∏è‚É£ RECOMMENDED ACTIONS</h3>
  <ul>${resultData.advice.map(a => `<li>${a}</li>`).join('')}</ul>
  <br>
  <h3>8Ô∏è‚É£ LEGAL & CYBER SAFETY REFERENCE</h3>
  <b>Relevant Law:</b> ${resultData.legalReference}<br>
  <b>Reporting Authority:</b> National Cyber Crime Portal
  `;
  document.getElementById('dangerText').innerText = resultData.explanation;
  let adv = document.getElementById('advice');
  adv.innerHTML = "";
  resultData.advice.forEach(a => adv.innerHTML += `<li>${a}</li>`);
  saveHistory();
  setTimeout(() => show('report'), 1500);
}

function saveHistory() {
  let h = JSON.parse(localStorage.getItem("scans") || "[]");
  h.unshift({ ...resultData, time: new Date().toLocaleString() });
  localStorage.setItem("scans", JSON.stringify(h));
  let list = document.getElementById("historyList");
  list.innerHTML = "";
  h.forEach(i => list.innerHTML += `<div class="card">${i.time} ‚Äî ${i.status} ‚Äî Category: ${i.category}</div>`);
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  let pdf = new jsPDF();
  
  // Changed to solid black background
  pdf.setFillColor(0, 0, 0); // Black
  pdf.rect(0, 0, 210, 297, 'F');
  
  // Title with same style (heading remains as is)
  pdf.setTextColor(0, 255, 204); // Cyan
  pdf.setFont('helvetica', 'bold');
  pdf.setFontSize(20);
  pdf.text("SCAM SHIELD ‚Äì CYBER FORENSIC REPORT", 20, 30);
  
  // Add date and time
  pdf.setTextColor(255, 255, 255);
  pdf.setFontSize(12);
  pdf.text("Generated on: " + new Date().toLocaleString(), 20, 45);
  
  // Colored border
  pdf.setDrawColor(0, 255, 204);
  pdf.setLineWidth(3);
  pdf.rect(10, 10, 190, 280);
  
  // Inner text with more readable font: 'times' serif font, larger size (18) for better readability
  pdf.setTextColor(255, 255, 255);
  pdf.setFont('times', 'normal'); // Serif for readability
  pdf.setFontSize(18); // Increased for readability
  let y = 60;
  pdf.text("1Ô∏è‚É£ BASIC CASE INFORMATION", 20, y);
  y += 15;
  pdf.text("Report ID: " + resultData.reportId, 20, y);
  y += 10;
  pdf.text("Scan Date & Time: " + resultData.scanDateTime, 20, y);
  y += 10;
  pdf.text("Input Type: " + resultData.inputType, 20, y);
  y += 10;
  pdf.text("Source: " + resultData.source, 20, y);
  y += 10;
  pdf.text("User Location: " + resultData.userLocation, 20, y);
  y += 20;
  pdf.text("2Ô∏è‚É£ SCAM CLASSIFICATION", 20, y);
  y += 15;
  pdf.text("Scam Type: " + resultData.category, 20, y);
  y += 10;
  pdf.text("Target Victim: " + resultData.targetVictim, 20, y);
  y += 20;
  pdf.text("3Ô∏è‚É£ THREAT SEVERITY ASSESSMENT", 20, y);
  y += 15;
  pdf.text("Risk Level: " + (resultData.status === 'HIGH RISK' ? 'üî¥ High' : resultData.status === 'MEDIUM RISK' ? 'üü† Medium' : 'üü¢ Low'), 20, y);
  y += 10;
  pdf.text("Risk Score: " + resultData.score + "%", 20, y);
  y += 10;
  pdf.text("Urgency Detected: " + resultData.urgencyDetected, 20, y);
  y += 10;
  pdf.text("Financial Threat Present: " + resultData.financialThreat, 20, y);
  y += 20;
  pdf.text("4Ô∏è‚É£ SCAM PATTERN ANALYSIS", 20, y);
  y += 15;
  pdf.text("Psychological Techniques Used: " + resultData.psychologicalTechniques, 20, y);
  y += 10;
  pdf.text("Red Flags Detected: " + resultData.redFlags.join(', '), 20, y);
  y += 20;
  pdf.text("5Ô∏è‚É£ WHY THIS SCAM IS DANGEROUS", 20, y);
  y += 15;
  pdf.text(resultData.explanation, 20, y, { maxWidth: 170 });
  y += 30;
  pdf.text("6Ô∏è‚É£ POTENTIAL IMPACT ANALYSIS", 20, y);
  y += 15;
  pdf.text(resultData.potentialImpact, 20, y, { maxWidth: 170 });
  y += 20;
  pdf.text("7Ô∏è‚É£ RECOMMENDED ACTIONS", 20, y);
  y += 15;
  resultData.advice.forEach(a => {
        pdf.text("‚Ä¢ " + a, 20, y);
    y += 10;
  });
  y += 10;
  pdf.text("8Ô∏è‚É£ LEGAL & CYBER SAFETY REFERENCE", 20, y);
  y += 15;
  pdf.text("Relevant Law: " + resultData.legalReference, 20, y);
  y += 10;
  pdf.text("Reporting Authority: National Cyber Crime Portal", 20, y);
  
  pdf.save("Cyber_Shield_Report.pdf");
}

function showProfile() {
  const user = JSON.parse(localStorage.getItem('user'));
  if (user) {
    document.getElementById('profileInfo').innerHTML = `
      <b>USERNAME:</b> ${user.username}<br>
      <b>EMAIL:</b> ${user.email}<br>
      <b>ACCOUNT CREATED:</b> ${new Date().toLocaleString()} (Simulated)
    `;
  }
}

function editProfile() {
  const user = JSON.parse(localStorage.getItem('user'));
  if (user) {
    document.getElementById('editUsername').value = user.username;
    document.getElementById('editEmail').value = user.email;
    document.getElementById('editPassword').value = '';
  }
  openModal('editProfile');
}

function saveProfile() {
  const username = document.getElementById('editUsername').value;
  const email = document.getElementById('editEmail').value;
  const password = document.getElementById('editPassword').value;

  if (!username || !email) {
    alert('Username and Email are required.');
    return;
  }

  const user = JSON.parse(localStorage.getItem('user'));
  user.username = username;
  user.email = email;
  if (password) user.password = password;

  localStorage.setItem('user', JSON.stringify(user));
  closeModal('editProfile');
  showProfile();
  alert('Profile updated successfully!');
}
</script>
